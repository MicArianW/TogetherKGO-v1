<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TogetherKGO ‚Äì Food Resources</title>

    <!-- CSS -->
    <link rel="stylesheet" href="assets/styles.css" />

    <!-- Load config FIRST (this contains API KEY) -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="config.js"></script>

    <!-- App scripts -->
    <script defer src="assets/i18n.js"></script>
    <script defer src="assets/app.js"></script>
    
    <style>
      /* Navigation override to match home page */
      .app-header {
        background: #FFFFFF;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        padding: 1rem 2rem;
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .branding {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      
      .branding .logo {
        font-size: 1.5rem;
        color: #7DBFE8;
        text-decoration: none;
        font-weight: bold;
      }
      
      .top-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
      }
      
      /* Style nav links like home page */
      .top-actions a.chip.ghost,
      .top-actions button.chip.ghost,
      .top-actions a.nav-link {
        color: #1F2937;
        text-decoration: none;
        font-weight: 700;
        transition: all 0.3s;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        background: #FFFFFF;
        border: 2px solid #C8E6C9;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        font-family: inherit;
        font-size: 1rem;
      }
      
      .top-actions a.chip.ghost:hover,
      .top-actions button.chip.ghost:hover,
      .top-actions a.nav-link:hover {
        color: #7DBFE8;
        border-color: #7DBFE8;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }
      
      /* Inline Language Dropdown for food-banks page */
      /* Home Dropdown with Hover */
      .nav-dropdown-home-inline {
        position: relative;
        display: inline-block;
      }
      
      .nav-dropdown-menu-home-inline {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        margin-top: 0.5rem;
        background: #FFFFFF;
        border: 2px solid #C8E6C9;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        min-width: 200px;
        z-index: 10000;
        opacity: 0;
        transform: translateY(-10px);
        transition: opacity 0.3s ease, transform 0.3s ease;
        pointer-events: none;
      }
      
      /* Show dropdown on hover */
      .nav-dropdown-home-inline:hover .nav-dropdown-menu-home-inline {
        display: block;
        opacity: 1;
        transform: translateY(0);
        pointer-events: all;
      }
      
      .nav-dropdown-menu-home-inline a {
        display: block;
        padding: 0.75rem 1.25rem;
        color: #1F2937;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.2s;
        border: none;
        box-shadow: none;
        border-radius: 0;
        background: #FFFFFF;
      }
      
      .nav-dropdown-menu-home-inline a:first-child {
        border-radius: 6px 6px 0 0;
      }
      
      .nav-dropdown-menu-home-inline a:last-child {
        border-radius: 0 0 6px 6px;
      }
      
      .nav-dropdown-menu-home-inline a:hover {
        background: #E3F2FD;
        color: #7DBFE8;
        transform: none;
        box-shadow: none;
      }

      /* Inline Language Dropdown for food-banks page */
      .language-dropdown-inline {
        position: relative;
        display: inline-block;
      }
      
      .language-btn-inline {
        cursor: pointer;
        user-select: none;
      }
      
      .language-menu-inline {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 0.5rem;
        background: #FFFFFF;
        border: 2px solid #C8E6C9;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        min-width: 200px;
        z-index: 10000;
        max-height: 400px;
        overflow-y: auto;
      }
      
      .language-menu-inline.show {
        display: block;
      }
      
      .language-menu-inline a {
        display: block;
        padding: 0.75rem 1.25rem;
        color: #1F2937;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.2s;
        border: none;
        box-shadow: none;
        border-radius: 0;
        background: #FFFFFF;
      }
      
      .language-menu-inline a:first-child {
        border-radius: 6px 6px 0 0;
      }
      
      .language-menu-inline a:last-child {
        border-radius: 0 0 6px 6px;
      }
      
      .language-menu-inline a:hover {
        background: #E3F2FD;
        color: #7DBFE8;
        transform: none;
        box-shadow: none;
      }
      
      @media (max-width: 1024px) {
        .app-header {
          flex-direction: column;
          gap: 1rem;
        }
        
        .top-actions {
          flex-wrap: wrap;
          justify-content: center;
          gap: 0.5rem;
        }
        
        .top-actions a.chip.ghost {
          padding: 0.5rem 1rem;
          font-size: 0.9rem;
        }
      }
    </style>
  </head>

  <body>
    <header class="app-header">
      <div class="branding">
        <a href="index.html" class="logo">TogetherKGO</a>
      </div>

      <nav class="top-actions">
        <div class="language-dropdown-inline nav-dropdown-home-inline">
          <a class="chip ghost" href="index.html">Home</a>
          <div class="nav-dropdown-menu-home-inline" id="navDropdownMenuHomeInline">
            <a href="food-banks.html">Find Food Banks</a>
            <a href="community.html">Community Board</a>
            <a href="submit-listing.html">Submit Listing</a>
            <a href="resources.html">Resources</a>
          </div>
        </div>
        <button class="chip ghost" onclick="showTranslationNotSupported()">üåê Languages</button>
      </nav>
    </header>

    <main class="layout">
      <aside class="sidebar">
        <section class="card">
          <h2 data-i18n="search_filters">Search & Filters</h2>

          <label class="label" for="q" data-i18n="search_label">Search by name, keywords</label>
          <input id="q" type="search" placeholder="food bank, community support‚Ä¶" />

          <div class="grid2">
            <div>
              <label class="label" for="type">Type</label>
              <select id="type">
                <option value="">Any</option>
                <option value="food_bank">Food Bank</option>
                <option value="organization">Organization</option>
                <option value="community_meal">Community Meal</option>
                <option value="pantry">Pantry</option>
                <option value="market">Market</option>
                <option value="delivery">Delivery</option>
              </select>
            </div>

            <div>
              <label class="label" for="openDay">Day Open</label>
              <select id="openDay">
                <option value="">Any</option>
                <option value="Mon">Monday</option>
                <option value="Tue">Tuesday</option>
                <option value="Wed">Wednesday</option>
                <option value="Thu">Thursday</option>
                <option value="Fri">Friday</option>
                <option value="Sat">Saturday</option>
                <option value="Sun">Sunday</option>
              </select>
            </div>
          </div>

          <div>
            <label class="label" for="radius">Search Radius</label>
            <select id="radius">
              <option value="99999">All Locations</option>
              <option value="1000">Within 1 km</option>
              <option value="2000">Within 2 km</option>
              <option value="3000">Within 3 km</option>
              <option value="5000">Within 5 km</option>
            </select>
          </div>

          <div class="actions">
            <button id="applyBtn" class="primary">Apply Filters</button>
            <button id="resetBtn" class="ghost">Reset</button>
          </div>
        </section>

        <section class="card info-card">
          <h3>About Food Resources</h3>
          <p class="subtle">Find food banks and community support services in the Kingston-Galloway-Orton Park area. All services are free and open to community members in need.</p>
          
          <div class="quick-contact">
            <strong>Need Help?</strong>
            <p class="subtle small">Contact any of the listed organizations directly for assistance or visit them during their operating hours.</p>
          </div>
        </section>
      </aside>

      <section class="content">
        <div id="map" class="map notranslate" translate="no"></div>

        <section class="list card">
          <h2>Food Resources in KGO Area</h2>
          <div id="resultCount" class="subtle"></div>
          <ul id="results"></ul>
        </section>
      </section>
    </main>

    <!-- Google Maps Loader -->
    <script>
      function loadGoogleMaps() {
        if (!window.__CONFIG__ || !window.__CONFIG__.GOOGLE_MAPS_API_KEY) {
          console.error("Missing API key in config.js");
          return;
        }

        const script = document.createElement("script");
        script.src =
          "https://maps.googleapis.com/maps/api/js?key=" +
          window.__CONFIG__.GOOGLE_MAPS_API_KEY +
          "&callback=initMap";

        script.async = true;
        script.defer = true;

        document.body.appendChild(script);
      }

      function initMap() {
        if (window.__APP && window.__APP.initMap) {
          window.__APP.initMap();
        } else {
          console.error("APP not ready yet");
        }
      }

      window.initMap = initMap;

      // Load Google Maps AFTER config.js and app.js
      window.addEventListener("DOMContentLoaded", loadGoogleMaps);
    </script>

    <!-- Floating Language Button -->
    <style>
    
    /* CRITICAL: Protect ONLY map and results from translation */
    /* Sidebar, filters, and labels WILL translate */
    #map,
    #map *,
    .leaflet-container,
    .leaflet-container *,
    .mapboxgl-map,
    .mapboxgl-map *,
    #results,
    #results * {
        translate: no !important;
    }
    
    .notranslate,
    .notranslate * {
        translate: no !important;
    }
    
    </style>

    <!-- Translation Script -->
    <script type="text/javascript">
        // Show not supported message
        function showTranslationNotSupported() {
            alert('Translation is not supported on this page.\n\nThe interactive map requires the page to remain in English to function properly.\n\nFor translated content, please visit:\n‚Ä¢ Home page\n‚Ä¢ Community page\n‚Ä¢ Resources page');
        }
    </script>

  </body>
</html>
